<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="专业课 - 基于并行计算的代码优化" /><meta name="author" content="Stone SHI" /><meta property="og:locale" content="en" /><meta name="description" content="1. Compilation and executation" /><meta property="og:description" content="1. Compilation and executation" /><link rel="canonical" href="/posts/Code-optimization/" /><meta property="og:url" content="/posts/Code-optimization/" /><meta property="og:site_name" content="Stone SHI" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-10-11T21:14:00+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="专业课 - 基于并行计算的代码优化" /><meta name="twitter:site" content="@Shuxin_Shi" /><meta name="twitter:creator" content="@Stone SHI" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Stone SHI"},"dateModified":"2021-12-21T17:45:35+08:00","datePublished":"2021-10-11T21:14:00+08:00","description":"1. Compilation and executation","headline":"专业课 - 基于并行计算的代码优化","mainEntityOfPage":{"@type":"WebPage","@id":"/posts/Code-optimization/"},"url":"/posts/Code-optimization/"}</script><title>专业课 - 基于并行计算的代码优化 | Stone SHI</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Stone SHI"><meta name="application-name" content="Stone SHI"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://i.loli.net/2021/10/18/ZQlvsDd2akF9c1C.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Stone SHI</a></div><div class="site-subtitle font-italic">Personal blog used to record my learning, progress, and life.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/PPPPierre" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/Shuxin_Shi" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['ssxhcxr4691059','163.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>专业课 - 基于并行计算的代码优化</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>专业课 - 基于并行计算的代码优化</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Stone SHI </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Mon, Oct 11, 2021, 9:14 PM +0800" >Oct 11, 2021<i class="unloaded">2021-10-11T21:14:00+08:00</i> </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Tue, Dec 21, 2021, 10:45 AM +0100" >Dec 21, 2021<i class="unloaded">2021-12-21T17:45:35+08:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="3789 words">21 min read</span></div></div><div class="post-content"><h1 id="1-compilation-and-executation">1. Compilation and executation</h1><p>compile.</p><div class="language-sh highlighter-rouge"><div class="code-header" text-data="sh"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="nv">$ </span>make
cc    <span class="nt">-c</span> <span class="nt">-o</span> io.o io.c
cc    <span class="nt">-c</span> <span class="nt">-o</span> transfo.o transfo.c
cc    <span class="nt">-c</span> <span class="nt">-o</span> cycles.o cycles.c
cc <span class="nt">-o</span> transform_image io.o transfo.o cycles.o
</pre></table></code></div></div><p>clean compilation output files.</p><div class="language-sh highlighter-rouge"><div class="code-header" text-data="sh"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nv">$ </span>make clean
<span class="nb">rm</span> <span class="nt">-f</span> <span class="k">*</span>.o transform_image
<span class="nb">rm</span> <span class="nt">-fr</span> cmake-build-debug
</pre></table></code></div></div><p>The first executation.</p><p>enter <code class="language-plaintext highlighter-rouge">imagerie</code> folder, set the environmental variable</p><div class="language-sh highlighter-rouge"><div class="code-header" text-data="sh"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">export </span><span class="nv">IMAGES</span><span class="o">=</span>../data
</pre></table></code></div></div><div class="language-sh highlighter-rouge"><div class="code-header" text-data="sh"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">time</span> ./transform_image <span class="nv">$IMAGES</span>/transfo.txt
image1.pgm courbe1.amp 5 image1_t.pgm
image1.pgm: 5617 x 3684 <span class="o">=</span> 20693028 pixels
1174160151.000000 clock cycles.
image2.pgm courbe2.amp 5 image2_t.pgm
image2.pgm: 5227 x 3515 <span class="o">=</span> 18372905 pixels
1095196812.000000 clock cycles.
image3.pgm courbe3.amp 5 image3_t.pgm
image3.pgm: 6660 x 9185 <span class="o">=</span> 61172100 pixels
3534617694.000000 clock cycles.
image4.pgm courbe4.amp 4 image4_t.pgm
image4.pgm: 3381 x 4914 <span class="o">=</span> 16614234 pixels
909382992.000000 clock cycles.
image5.pgm courbe5.amp 7 image5_t.pgm
image5.pgm: 3226 x 3255 <span class="o">=</span> 10500630 pixels
622586028.000000 clock cycles.
image6.pgm courbe6.amp 6 image6_t.pgm
image6.pgm: 3677 x 3677 <span class="o">=</span> 13520329 pixels
851808507.000000 clock cycles.
image7.pgm courbe7.amp 9 image7_t.pgm
image7.pgm: 3264 x 4896 <span class="o">=</span> 15980544 pixels
875622380.000000 clock cycles.
image8.pgm courbe8.amp 5 image8_t.pgm
image8.pgm: 1757 x 2636 <span class="o">=</span> 4631452 pixels
212227580.000000 clock cycles.
image9.pgm courbe9.amp 7 image9_t.pgm
image9.pgm: 2498 x 3330 <span class="o">=</span> 8318340 pixels
410359449.000000 clock cycles.
image10.pgm courbe10.amp 9 image10_t.pgm
image10.pgm: 3024 x 3024 <span class="o">=</span> 9144576 pixels
486787547.000000 clock cycles.
TOTAL: 10172749140.000000 clock cycles.

real    0m20.266s
user    0m10.037s
sys     0m0.564s
</pre></table></code></div></div><p>After the verification, enter the <code class="language-plaintext highlighter-rouge">data</code> folder, clean the output files.</p><div class="language-sh highlighter-rouge"><div class="code-header" text-data="sh"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span>./clean.sh
</pre></table></code></div></div><h1 id="2-optimisations-优化代码">2. Optimisations 优化代码</h1><p>À chaque modification, relancer le code et mesurer le gain obtenu. Garder trace de chaque version de votre code avec le gain obtenu. Recommendations:</p><ol><li><p>Utiliser moins de fonctions</p><li><p>Mieux utiliser la mémoire (localité)</p><li><p>Utiliser moins de boucles</p></ol><p>Vous pouvez vous aider de <a href="https://www.brendangregg.com/perf.html">perf</a> (si vous êtes sous Linux) pour analyser plus finement le comportement de votre code</p><h2 id="analysis-of-the-source-code-源代码解析">Analysis of the source code 源代码解析</h2><p>首先查看算法源代码，结合<code class="language-plaintext highlighter-rouge">data\transfo.txt</code>文件内容可以得出，这是一个将一张图片复制、进行像素值变换并提高亮度的算法。</p><div class="language-c highlighter-rouge"><div class="code-header" text-data="c"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
</pre><td class="rouge-code"><pre><span class="kt">void</span> <span class="nf">copy</span> <span class="p">(</span><span class="kt">int</span> <span class="n">w</span><span class="p">,</span> <span class="kt">int</span> <span class="n">h</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">src</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">dest</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">;</span>

  	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">w</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">h</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">dest</span><span class="p">[</span><span class="n">j</span> <span class="o">*</span> <span class="n">w</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">src</span><span class="p">[</span><span class="n">j</span> <span class="o">*</span> <span class="n">w</span> <span class="o">+</span> <span class="n">i</span><span class="p">];</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">light</span><span class="p">(</span><span class="kt">int</span> <span class="n">w</span><span class="p">,</span> <span class="kt">int</span> <span class="n">h</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">img</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">val</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">current</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">w</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">h</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">current</span> <span class="o">=</span> <span class="n">img</span><span class="p">[</span><span class="n">j</span> <span class="o">*</span> <span class="n">w</span> <span class="o">+</span> <span class="n">i</span><span class="p">];</span>
			<span class="n">img</span><span class="p">[</span><span class="n">j</span> <span class="o">*</span> <span class="n">w</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(((</span><span class="kt">int</span><span class="p">)</span> <span class="n">current</span> <span class="o">+</span> <span class="n">val</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">255</span><span class="p">)</span> <span class="o">?</span> <span class="mi">255</span> <span class="o">:</span> <span class="n">current</span> <span class="o">+</span> <span class="n">val</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">curve</span><span class="p">(</span><span class="kt">int</span> <span class="n">w</span><span class="p">,</span> <span class="kt">int</span> <span class="n">h</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">img</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">lut</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">;</span>
  	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">current</span><span class="p">;</span>

  	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">w</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
  		<span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">h</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
  			<span class="n">current</span> <span class="o">=</span> <span class="n">img</span><span class="p">[</span><span class="n">j</span> <span class="o">*</span> <span class="n">w</span> <span class="o">+</span> <span class="n">i</span><span class="p">];</span>
			<span class="n">img</span><span class="p">[</span><span class="n">j</span> <span class="o">*</span> <span class="n">w</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">lut</span><span class="p">[</span><span class="n">current</span><span class="p">];</span>
  		<span class="p">}</span>
  	<span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">transfo</span><span class="p">(</span><span class="kt">int</span> <span class="n">w</span><span class="p">,</span> <span class="kt">int</span> <span class="n">h</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">src</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">dest</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">lut</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">val</span><span class="p">)</span>
<span class="p">{</span>
  	<span class="n">copy</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">dest</span><span class="p">);</span>
  	<span class="n">curve</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">lut</span><span class="p">);</span>
  	<span class="n">light</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><h2 id="优化1">优化1</h2><p>将三个函数压缩成一个函数，减少重复遍历</p><p>Combine three functions to one, reduece the total times of iteration.</p><pre><code class="language-C">/*
void copy (int w, int h, unsigned char *src, unsigned char *dest)
{
	int i,j;

  	for (i = 0; i &lt; w; i++) {
		for (j = 0; j &lt; h; j++) {
			dest[j * w + i] = src[j * w + i];
		}
	}
}

void light(int w, int h, unsigned char *img, unsigned char val)
{
	int i,j;
	unsigned char current;

	for (i = 0; i &lt; w; i++) {
		for (j = 0; j &lt; h; j++) {
			current = img[j * w + i];
			img[j * w + i] = (((int) current + val) &gt; 255) ? 255 : current + val;
		}
	}
}

void curve(int w, int h, unsigned char *img, unsigned char *lut)
{
	int i,j;
  	unsigned char current;

  	for (i = 0; i &lt; w; i++) {
  		for (j = 0; j &lt; h; j++) {
  			current = img[j * w + i];
			img[j * w + i] = lut[current];
  		}
  	}
}
*/

void loop_process(int w, int h, unsigned char *src, unsigned char *dest, unsigned char *lut, unsigned char val){
	int i,j;
  	unsigned char current;

  	for (i = 0; i &lt; w; i++) {

		for (j = 0; j &lt; h; j++) {
			// copy
			dest[j * w + i] = src[j * w + i];

			// curve
			current = dest[j * w + i];
			dest[j * w + i] = lut[current];

			// light
            current = dest[j * w + i];
			dest[j * w + i] = (((int) current + val) &gt; 255) ? 255 : current + val;
		}
  	}
}

void transfo(int w, int h, unsigned char *src, unsigned char *dest, unsigned char *lut, unsigned char val)
{
	/*
  	copy(w, h, src, dest);
  	curve(w, h, dest, lut);
  	light(w, h, dest, val);
	*/

	loop_process(w, h, src, dest, lut, val);

}
</code></pre><p>Test</p><div class="language-sh highlighter-rouge"><div class="code-header" text-data="sh"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">time</span> ./transform_image <span class="nv">$IMAGES</span>/transfo.txt
image1.pgm courbe1.amp 5 image1_t.pgm
image1.pgm: 5617 x 3684 <span class="o">=</span> 20693028 pixels
718480772.000000 clock cycles.
image2.pgm courbe2.amp 5 image2_t.pgm
image2.pgm: 5227 x 3515 <span class="o">=</span> 18372905 pixels
668396133.000000 clock cycles.
image3.pgm courbe3.amp 5 image3_t.pgm
image3.pgm: 6660 x 9185 <span class="o">=</span> 61172100 pixels
2273278456.000000 clock cycles.
image4.pgm courbe4.amp 4 image4_t.pgm
image4.pgm: 3381 x 4914 <span class="o">=</span> 16614234 pixels
590257783.000000 clock cycles.
image5.pgm courbe5.amp 7 image5_t.pgm
image5.pgm: 3226 x 3255 <span class="o">=</span> 10500630 pixels
336672412.000000 clock cycles.
image6.pgm courbe6.amp 6 image6_t.pgm
image6.pgm: 3677 x 3677 <span class="o">=</span> 13520329 pixels
440642125.000000 clock cycles.
image7.pgm courbe7.amp 9 image7_t.pgm
image7.pgm: 3264 x 4896 <span class="o">=</span> 15980544 pixels
520065354.000000 clock cycles.
image8.pgm courbe8.amp 5 image8_t.pgm
image8.pgm: 1757 x 2636 <span class="o">=</span> 4631452 pixels
127555428.000000 clock cycles.
image9.pgm courbe9.amp 7 image9_t.pgm
image9.pgm: 2498 x 3330 <span class="o">=</span> 8318340 pixels
235020610.000000 clock cycles.
image10.pgm courbe10.amp 9 image10_t.pgm
image10.pgm: 3024 x 3024 <span class="o">=</span> 9144576 pixels
292524428.000000 clock cycles.
TOTAL: 6202893501.000000 clock cycles.

real    0m17.814s
user    0m7.847s
sys     0m0.653s
</pre></table></code></div></div><p>2-3 seconds faster</p><h2 id="优化2">优化2</h2><p>We can compress two <code class="language-plaintext highlighter-rouge">for</code> into one <code class="language-plaintext highlighter-rouge">for</code> loop.</p><p>显然两个 <code class="language-plaintext highlighter-rouge">for</code> 循环可以压缩成一个 <code class="language-plaintext highlighter-rouge">for</code> 循环。</p><p>The improved codes are shown below.</p><p>改完代码如下：</p><div class="language-c highlighter-rouge"><div class="code-header" text-data="c"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="kt">void</span> <span class="nf">loop_process</span><span class="p">(</span><span class="kt">int</span> <span class="n">w</span><span class="p">,</span> <span class="kt">int</span> <span class="n">h</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">src</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">dest</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">lut</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">val</span><span class="p">){</span>
	<span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="n">w</span> <span class="o">*</span> <span class="n">h</span><span class="p">;</span>
  	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">current</span><span class="p">;</span>

	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

  	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="c1">// copy</span>
		<span class="n">dest</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">src</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>

		<span class="c1">// curve</span>
		<span class="n">current</span> <span class="o">=</span> <span class="n">dest</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
		<span class="n">dest</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">lut</span><span class="p">[</span><span class="n">current</span><span class="p">];</span>

		<span class="c1">// light</span>
        <span class="n">current</span> <span class="o">=</span> <span class="n">dest</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
		<span class="n">dest</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(((</span><span class="kt">int</span><span class="p">)</span> <span class="n">current</span> <span class="o">+</span> <span class="n">val</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">255</span><span class="p">)</span> <span class="o">?</span> <span class="mi">255</span> <span class="o">:</span> <span class="n">current</span> <span class="o">+</span> <span class="n">val</span><span class="p">;</span>
  	<span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Test</p><div class="language-sh highlighter-rouge"><div class="code-header" text-data="sh"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">time</span> ./transform_image <span class="nv">$IMAGES</span>/transfo.txt
image1.pgm courbe1.amp 5 image1_t.pgm
image1.pgm: 5617 x 3684 <span class="o">=</span> 20693028 pixels
241626861.000000 clock cycles.
image2.pgm courbe2.amp 5 image2_t.pgm
image2.pgm: 5227 x 3515 <span class="o">=</span> 18372905 pixels
207095052.000000 clock cycles.
image3.pgm courbe3.amp 5 image3_t.pgm
image3.pgm: 6660 x 9185 <span class="o">=</span> 61172100 pixels
688837133.000000 clock cycles.
image4.pgm courbe4.amp 4 image4_t.pgm
image4.pgm: 3381 x 4914 <span class="o">=</span> 16614234 pixels
188729000.000000 clock cycles.
image5.pgm courbe5.amp 7 image5_t.pgm
image5.pgm: 3226 x 3255 <span class="o">=</span> 10500630 pixels
110668988.000000 clock cycles.
image6.pgm courbe6.amp 6 image6_t.pgm
image6.pgm: 3677 x 3677 <span class="o">=</span> 13520329 pixels
153436717.000000 clock cycles.
image7.pgm courbe7.amp 9 image7_t.pgm
image7.pgm: 3264 x 4896 <span class="o">=</span> 15980544 pixels
216416799.000000 clock cycles.
image8.pgm courbe8.amp 5 image8_t.pgm
image8.pgm: 1757 x 2636 <span class="o">=</span> 4631452 pixels
48847379.000000 clock cycles.
image9.pgm courbe9.amp 7 image9_t.pgm
image9.pgm: 2498 x 3330 <span class="o">=</span> 8318340 pixels
87362807.000000 clock cycles.
image10.pgm courbe10.amp 9 image10_t.pgm
image10.pgm: 3024 x 3024 <span class="o">=</span> 9144576 pixels
110621170.000000 clock cycles.
TOTAL: 2053641906.000000 clock cycles.

real    0m17.044s
user    0m6.391s
sys     0m0.845s
</pre></table></code></div></div><p>1 sec faster.</p><h2 id="优化3">优化3</h2><p>Improve the algorithm:</p><p>算法显然可以再优化，优化完结果：</p><div class="language-c highlighter-rouge"><div class="code-header" text-data="c"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="kt">void</span> <span class="nf">loop_process</span><span class="p">(</span><span class="kt">int</span> <span class="n">w</span><span class="p">,</span> <span class="kt">int</span> <span class="n">h</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">src</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">dest</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">lut</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">val</span><span class="p">){</span>
	<span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="n">w</span> <span class="o">*</span> <span class="n">h</span><span class="p">;</span>
  	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">tmp</span><span class="p">;</span>

	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

  	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">current</span> <span class="o">=</span> <span class="n">src</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
		<span class="n">dest</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(((</span><span class="kt">int</span><span class="p">)</span> <span class="n">current</span> <span class="o">+</span> <span class="n">val</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">255</span><span class="p">)</span> <span class="o">?</span> <span class="mi">255</span> <span class="o">:</span> <span class="n">current</span> <span class="o">+</span> <span class="n">val</span><span class="p">;</span>
  	<span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Test</p><div class="language-sh highlighter-rouge"><div class="code-header" text-data="sh"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">time</span> ./transform_image <span class="nv">$IMAGES</span>/transfo.txt
image1.pgm courbe1.amp 5 image1_t.pgm
image1.pgm: 5617 x 3684 <span class="o">=</span> 20693028 pixels
107953226.000000 clock cycles.
image2.pgm courbe2.amp 5 image2_t.pgm
image2.pgm: 5227 x 3515 <span class="o">=</span> 18372905 pixels
88947604.000000 clock cycles.
image3.pgm courbe3.amp 5 image3_t.pgm
image3.pgm: 6660 x 9185 <span class="o">=</span> 61172100 pixels
336525503.000000 clock cycles.
image4.pgm courbe4.amp 4 image4_t.pgm
image4.pgm: 3381 x 4914 <span class="o">=</span> 16614234 pixels
78052902.000000 clock cycles.
image5.pgm courbe5.amp 7 image5_t.pgm
image5.pgm: 3226 x 3255 <span class="o">=</span> 10500630 pixels
50549115.000000 clock cycles.
image6.pgm courbe6.amp 6 image6_t.pgm
image6.pgm: 3677 x 3677 <span class="o">=</span> 13520329 pixels
63703490.000000 clock cycles.
image7.pgm courbe7.amp 9 image7_t.pgm
image7.pgm: 3264 x 4896 <span class="o">=</span> 15980544 pixels
75967615.000000 clock cycles.
image8.pgm courbe8.amp 5 image8_t.pgm
image8.pgm: 1757 x 2636 <span class="o">=</span> 4631452 pixels
22521228.000000 clock cycles.
image9.pgm courbe9.amp 7 image9_t.pgm
image9.pgm: 2498 x 3330 <span class="o">=</span> 8318340 pixels
39134269.000000 clock cycles.
image10.pgm courbe10.amp 9 image10_t.pgm
image10.pgm: 3024 x 3024 <span class="o">=</span> 9144576 pixels
43233903.000000 clock cycles.
TOTAL: 906588855.000000 clock cycles.

real    0m16.410s
user    0m5.832s
sys     0m0.806s
</pre></table></code></div></div><p>1s faster.</p><h2 id="优化4-loop-unrolling-循环展开">优化4 Loop unrolling 循环展开</h2><p>使用循环展开的技术来压缩时间。</p><p>优化后代码：</p><p>```c transfo.c void loop_process(int w, int h, unsigned char *src, unsigned char *dest, unsigned char *lut, unsigned char val){ int n = w * h; unsigned char current_0, current_1, current_2, current_3;</p><div class="language-plaintext highlighter-rouge"><div class="code-header" text-data="plaintext"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>int i;
</pre></table></code></div></div>for (i = 0; i &lt; n-3; i+=4) {<div class="language-plaintext highlighter-rouge"><div class="code-header" text-data="plaintext"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>	current_0 = lut[src[i]];
	current_1 = lut[src[i+1]];
	current_2 = lut[src[i+2]];
	current_3 = lut[src[i+3]];
	dest[i] = (((int) current_0 + val) &gt; 255) ? 255 : current_0 + val;
	dest[i+1] = (((int) current_1 + val) &gt; 255) ? 255 : current_1 + val;
	dest[i+2] = (((int) current_2 + val) &gt; 255) ? 255 : current_2 + val;
	dest[i+3] = (((int) current_3 + val) &gt; 255) ? 255 : current_3 + val;
  	} } ```
</pre></table></code></div></div><p>Test</p><div class="language-sh highlighter-rouge"><div class="code-header" text-data="sh"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">time</span> ./transform_image <span class="nv">$IMAGES</span>/transfo.txt
image1.pgm courbe1.amp 5 image1_t.pgm
image1.pgm: 5617 x 3684 <span class="o">=</span> 20693028 pixels
93511300.000000 clock cycles.
image2.pgm courbe2.amp 5 image2_t.pgm
image2.pgm: 5227 x 3515 <span class="o">=</span> 18372905 pixels
74312291.000000 clock cycles.
image3.pgm courbe3.amp 5 image3_t.pgm
image3.pgm: 6660 x 9185 <span class="o">=</span> 61172100 pixels
295375831.000000 clock cycles.
image4.pgm courbe4.amp 4 image4_t.pgm
image4.pgm: 3381 x 4914 <span class="o">=</span> 16614234 pixels
65381472.000000 clock cycles.
image5.pgm courbe5.amp 7 image5_t.pgm
image5.pgm: 3226 x 3255 <span class="o">=</span> 10500630 pixels
41186202.000000 clock cycles.
image6.pgm courbe6.amp 6 image6_t.pgm
image6.pgm: 3677 x 3677 <span class="o">=</span> 13520329 pixels
53358892.000000 clock cycles.
image7.pgm courbe7.amp 9 image7_t.pgm
image7.pgm: 3264 x 4896 <span class="o">=</span> 15980544 pixels
63093263.000000 clock cycles.
image8.pgm courbe8.amp 5 image8_t.pgm
image8.pgm: 1757 x 2636 <span class="o">=</span> 4631452 pixels
18141256.000000 clock cycles.
image9.pgm courbe9.amp 7 image9_t.pgm
image9.pgm: 2498 x 3330 <span class="o">=</span> 8318340 pixels
33467929.000000 clock cycles.
image10.pgm courbe10.amp 9 image10_t.pgm
image10.pgm: 3024 x 3024 <span class="o">=</span> 9144576 pixels
36029574.000000 clock cycles.
TOTAL: 773858010.000000 clock cycles.

real    0m14.911s
user    0m4.991s
sys     0m0.510s
</pre></table></code></div></div><p>性能提高。</p><p>Better performance.</p><h1 id="优化5">优化5</h1><p><code class="language-plaintext highlighter-rouge">lut</code> saturation.</p><p>可以对<code class="language-plaintext highlighter-rouge">lut</code>变换的数组先加<code class="language-plaintext highlighter-rouge">val</code>进行饱和判断操作，然后遍历进行变换，这样会减少更多循环的次数以及<code class="language-plaintext highlighter-rouge">if</code>判断的次数。</p><div class="language-c highlighter-rouge"><div class="code-header" text-data="c"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="kt">void</span> <span class="nf">loop_process</span><span class="p">(</span><span class="kt">int</span> <span class="n">w</span><span class="p">,</span> <span class="kt">int</span> <span class="n">h</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">src</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">dest</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">lut</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">val</span><span class="p">){</span>
	<span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="n">w</span> <span class="o">*</span> <span class="n">h</span><span class="p">;</span>

	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">255</span><span class="p">;</span> <span class="n">i</span> <span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">lut</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(((</span><span class="kt">int</span><span class="p">)</span> <span class="n">lut</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">val</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">255</span><span class="p">)</span> <span class="o">?</span> <span class="mi">255</span> <span class="o">:</span> <span class="n">lut</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">val</span><span class="p">;</span>
  	<span class="p">}</span>

  	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="o">-</span><span class="mi">3</span><span class="p">;</span> <span class="n">i</span><span class="o">+=</span><span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dest</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">lut</span><span class="p">[</span><span class="n">src</span><span class="p">[</span><span class="n">i</span><span class="p">]];</span>
		<span class="n">dest</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">lut</span><span class="p">[</span><span class="n">src</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]];</span>
		<span class="n">dest</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">lut</span><span class="p">[</span><span class="n">src</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]];</span>
		<span class="n">dest</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">lut</span><span class="p">[</span><span class="n">src</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">3</span><span class="p">]];</span>
  	<span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Test</p><div class="language-sh highlighter-rouge"><div class="code-header" text-data="sh"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">time</span> ./transform_image <span class="nv">$IMAGES</span>/transfo.txt
image1.pgm courbe1.amp 5 image1_t.pgm
image1.pgm: 5617 x 3684 <span class="o">=</span> 20693028 pixels
62751136.000000 clock cycles.
image2.pgm courbe2.amp 5 image2_t.pgm
image2.pgm: 5227 x 3515 <span class="o">=</span> 18372905 pixels
50819186.000000 clock cycles.
image3.pgm courbe3.amp 5 image3_t.pgm
image3.pgm: 6660 x 9185 <span class="o">=</span> 61172100 pixels
220661554.000000 clock cycles.
image4.pgm courbe4.amp 4 image4_t.pgm
image4.pgm: 3381 x 4914 <span class="o">=</span> 16614234 pixels
43584822.000000 clock cycles.
image5.pgm courbe5.amp 7 image5_t.pgm
image5.pgm: 3226 x 3255 <span class="o">=</span> 10500630 pixels
27588220.000000 clock cycles.
image6.pgm courbe6.amp 6 image6_t.pgm
image6.pgm: 3677 x 3677 <span class="o">=</span> 13520329 pixels
37273392.000000 clock cycles.
image7.pgm courbe7.amp 9 image7_t.pgm
image7.pgm: 3264 x 4896 <span class="o">=</span> 15980544 pixels
42147550.000000 clock cycles.
image8.pgm courbe8.amp 5 image8_t.pgm
image8.pgm: 1757 x 2636 <span class="o">=</span> 4631452 pixels
20684776.000000 clock cycles.
image9.pgm courbe9.amp 7 image9_t.pgm
image9.pgm: 2498 x 3330 <span class="o">=</span> 8318340 pixels
22268526.000000 clock cycles.
image10.pgm courbe10.amp 9 image10_t.pgm
image10.pgm: 3024 x 3024 <span class="o">=</span> 9144576 pixels
24155182.000000 clock cycles.
TOTAL: 551934344.000000 clock cycles.

real    0m15.721s
user    0m5.409s
sys     0m0.593s
</pre></table></code></div></div><p>反而下降了，说明这个方法没有改变太多。也可能是电脑运行久了变热了运算速度下降了。</p><p>The problem is that the system I used is wsl2 and the file path is in <code class="language-plaintext highlighter-rouge">/mnt/c/</code> which will make the reading process cost more time.</p><h1 id="parallélisations-并行计算">Parallélisation(s) 并行计算</h1><p>Voici des pistes de parallélisation, qui peuvent être complémentaires:</p><ol><li><strong>Vectorisation</strong>: utiliser les instructions vectorielles, soit en optimisant l’assembleur “à la main”, soit en utilisant les intrinsics x86 présents dans <a href="https://gcc.gnu.org/onlinedocs/gcc/x86-Built-in-Functions.html">GCC</a>, soit en utilisant les <a href="https://gcc.gnu.org/onlinedocs/gcc/Optimize-Options.html">bons paramètres du compilateur</a>. Cette étape nécessitera certainement d’aider le compilateur en lui présentant des boucles “facilement” vectorisables. Vérifiez également que GCC génère du code <a href="https://gcc.gnu.org/onlinedocs/gcc/x86-Options.html">correspondant à votre machine</a>. La documentation <a href="https://software.intel.com/content/www/us/en/develop/download/intel-64-and-ia-32-architectures-optimization-reference-manual.html">Intel</a> sur l’optimisation de code pour architecture x86-64 donne de nombreuses pistes d’optimisation.<li><strong>Multithreads</strong>: utiliser <a href="https://connect.ed-diamond.com/GNU-Linux-Magazine/glmf-122/decouverte-de-la-programmation-parallele-avec-openmp">OpenMP</a> pour obtenir une version du code utilisant plusieurs threads. Mesurer le gain obtenu en fonction du nombre de threads utilisés.<li><strong>Multiprocessus</strong>: modifier le code en utilisant plusieurs processus. On peut imaginer ici que l’on utilise des processus en parallèle où chaque processus s’occuperait d’une image. Ainsi, on pourra cherche ici à améliorer le temps pris par le traitement des dix images à la suite. Se rappeler de fork().<li><strong>GPU</strong>: utiliser CUDA afin d’obtenir une version du code fonctionnant sur un processeur graphique.</ol><h2 id="gcc-loop-distribution">GCC loop distribution</h2><p>在 <code class="language-plaintext highlighter-rouge">CMakeLists.txt</code>里面加上一句</p><p><code class="language-plaintext highlighter-rouge">SET ( CMAKE_CXX_FLAGS "-fopenmp" )</code></p><pre><code class="language-CMakeLists.txt">project(transform_image)

SET ( CMAKE_CXX_FLAGS "-fopenmp" )

add_executable(transform_image cycles.c cycles.h io.c transfo.c transfo.h)
</code></pre><p>然后在要加速的<code class="language-plaintext highlighter-rouge">for</code>循环前加一行<code class="language-plaintext highlighter-rouge">#pragma omp parallel for</code></p><div class="language-c highlighter-rouge"><div class="code-header" text-data="c"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="kt">void</span> <span class="nf">loop_process</span><span class="p">(</span><span class="kt">int</span> <span class="n">w</span><span class="p">,</span> <span class="kt">int</span> <span class="n">h</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">src</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">dest</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">lut</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">val</span><span class="p">){</span>
	<span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="n">w</span> <span class="o">*</span> <span class="n">h</span><span class="p">;</span>

	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="cp">#pragma omp parallel for
</span>	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">255</span><span class="p">;</span> <span class="n">i</span> <span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">lut</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(((</span><span class="kt">int</span><span class="p">)</span> <span class="n">lut</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">val</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">255</span><span class="p">)</span> <span class="o">?</span> <span class="mi">255</span> <span class="o">:</span> <span class="n">lut</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">val</span><span class="p">;</span>
  	<span class="p">}</span>

	<span class="cp">#pragma omp parallel for
</span>  	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="o">-</span><span class="mi">3</span><span class="p">;</span> <span class="n">i</span><span class="o">+=</span><span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dest</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">lut</span><span class="p">[</span><span class="n">src</span><span class="p">[</span><span class="n">i</span><span class="p">]];</span>
		<span class="n">dest</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">lut</span><span class="p">[</span><span class="n">src</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]];</span>
		<span class="n">dest</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">lut</span><span class="p">[</span><span class="n">src</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]];</span>
		<span class="n">dest</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">lut</span><span class="p">[</span><span class="n">src</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">3</span><span class="p">]];</span>
  	<span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>测试</p><div class="language-sh highlighter-rouge"><div class="code-header" text-data="sh"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">time</span> ./transform_image <span class="nv">$IMAGES</span>/transfo.txt
image1.pgm courbe1.amp 5 image1_t.pgm
image1.pgm: 5617 x 3684 <span class="o">=</span> 20693028 pixels
71895122.000000 clock cycles.
image2.pgm courbe2.amp 5 image2_t.pgm
image2.pgm: 5227 x 3515 <span class="o">=</span> 18372905 pixels
57267568.000000 clock cycles.
image3.pgm courbe3.amp 5 image3_t.pgm
image3.pgm: 6660 x 9185 <span class="o">=</span> 61172100 pixels
237394217.000000 clock cycles.
image4.pgm courbe4.amp 4 image4_t.pgm
image4.pgm: 3381 x 4914 <span class="o">=</span> 16614234 pixels
43233580.000000 clock cycles.
image5.pgm courbe5.amp 7 image5_t.pgm
image5.pgm: 3226 x 3255 <span class="o">=</span> 10500630 pixels
27222220.000000 clock cycles.
image6.pgm courbe6.amp 6 image6_t.pgm
image6.pgm: 3677 x 3677 <span class="o">=</span> 13520329 pixels
52180870.000000 clock cycles.
image7.pgm courbe7.amp 9 image7_t.pgm
image7.pgm: 3264 x 4896 <span class="o">=</span> 15980544 pixels
42858312.000000 clock cycles.
image8.pgm courbe8.amp 5 image8_t.pgm
image8.pgm: 1757 x 2636 <span class="o">=</span> 4631452 pixels
12074296.000000 clock cycles.
image9.pgm courbe9.amp 7 image9_t.pgm
image9.pgm: 2498 x 3330 <span class="o">=</span> 8318340 pixels
21542948.000000 clock cycles.
image10.pgm courbe10.amp 9 image10_t.pgm
image10.pgm: 3024 x 3024 <span class="o">=</span> 9144576 pixels
24088950.000000 clock cycles.
TOTAL: 589758083.000000 clock cycles.

real    0m14.813s
user    0m5.547s
sys     0m0.430s
</pre></table></code></div></div><p>有所效果，但不明显。</p><p>在不使用循环展开的情况下检查效果：</p><div class="language-c highlighter-rouge"><div class="code-header" text-data="c"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="kt">void</span> <span class="nf">loop_process</span><span class="p">(</span><span class="kt">int</span> <span class="n">w</span><span class="p">,</span> <span class="kt">int</span> <span class="n">h</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">src</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">dest</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">lut</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">val</span><span class="p">){</span>
	<span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="n">w</span> <span class="o">*</span> <span class="n">h</span><span class="p">;</span>

	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="cp">#pragma omp parallel for
</span>	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">255</span><span class="p">;</span> <span class="n">i</span> <span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">lut</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(((</span><span class="kt">int</span><span class="p">)</span> <span class="n">lut</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">val</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">255</span><span class="p">)</span> <span class="o">?</span> <span class="mi">255</span> <span class="o">:</span> <span class="n">lut</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">val</span><span class="p">;</span>
  	<span class="p">}</span>

	<span class="cp">#pragma omp parallel for
</span>  	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dest</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">lut</span><span class="p">[</span><span class="n">src</span><span class="p">[</span><span class="n">i</span><span class="p">]];</span>
  	<span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><div class="language-sh highlighter-rouge"><div class="code-header" text-data="sh"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">time</span> ./transform_image <span class="nv">$IMAGES</span>/transfo.txt
image1.pgm courbe1.amp 5 image1_t.pgm
image1.pgm: 5617 x 3684 <span class="o">=</span> 20693028 pixels
90885426.000000 clock cycles.
image2.pgm courbe2.amp 5 image2_t.pgm
image2.pgm: 5227 x 3515 <span class="o">=</span> 18372905 pixels
73543448.000000 clock cycles.
image3.pgm courbe3.amp 5 image3_t.pgm
image3.pgm: 6660 x 9185 <span class="o">=</span> 61172100 pixels
283044717.000000 clock cycles.
image4.pgm courbe4.amp 4 image4_t.pgm
image4.pgm: 3381 x 4914 <span class="o">=</span> 16614234 pixels
63834405.000000 clock cycles.
image5.pgm courbe5.amp 7 image5_t.pgm
image5.pgm: 3226 x 3255 <span class="o">=</span> 10500630 pixels
43076592.000000 clock cycles.
image6.pgm courbe6.amp 6 image6_t.pgm
image6.pgm: 3677 x 3677 <span class="o">=</span> 13520329 pixels
52240602.000000 clock cycles.
image7.pgm courbe7.amp 9 image7_t.pgm
image7.pgm: 3264 x 4896 <span class="o">=</span> 15980544 pixels
62215935.000000 clock cycles.
image8.pgm courbe8.amp 5 image8_t.pgm
image8.pgm: 1757 x 2636 <span class="o">=</span> 4631452 pixels
17739868.000000 clock cycles.
image9.pgm courbe9.amp 7 image9_t.pgm
image9.pgm: 2498 x 3330 <span class="o">=</span> 8318340 pixels
32985879.000000 clock cycles.
image10.pgm courbe10.amp 9 image10_t.pgm
image10.pgm: 3024 x 3024 <span class="o">=</span> 9144576 pixels
35069814.000000 clock cycles.
TOTAL: 754636686.000000 clock cycles.

real    0m14.513s
user    0m5.108s
sys     0m0.538s
</pre></table></code></div></div><p>可以看见和前者相差不大，循环展开提升的效果在并行计算的情况下被弱化了。</p><h2 id="multithreads---openmp">Multithreads - OpenMP</h2><p>OpenMP 官方上介绍的方法和上一个差不多，应该也是基于 gcc 编译过程中的 loop disstribution 的技术。</p><h2 id="multiprocessus---fork">Multiprocessus - fork()</h2><p>fork() functions.</p><p>使用消息队列完成进程的内部通信</p><p>导入两个进程相关的头文件 <code class="language-plaintext highlighter-rouge">&lt;unistd.h&gt;</code> <code class="language-plaintext highlighter-rouge">&lt;sys/wait.h&gt;</code></p><p>以及一个用于进程间信息交换的头文件 <code class="language-plaintext highlighter-rouge">&lt;sys/ipc.h&gt;</code></p><div class="language-c highlighter-rouge"><div class="code-header" text-data="c"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;sys/wait.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;sys/ipc.h&gt;</span><span class="cp">
</span></pre></table></code></div></div><p>```c io.c void run_transfo_file(FILE *tf) { char source[FNMAX]; char curve[FNMAX]; char dest[FNMAX]; int light;</p><div class="language-plaintext highlighter-rouge"><div class="code-header" text-data="plaintext"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre>pid_t child_pid, wpid;
int status = 0;
double total;

while (fscanf(tf, "%s %s %d %s", source, curve, &amp;light, dest) == 4) {
	child_pid = fork();
	if (child_pid == 0) {
		int res;
		printf("pid: %d %s %s %d %s\n",getpid(), source, curve, light, dest);
		total += transform_image(source, curve, light, dest);
		exit(0);
	}
}

while ((wpid = wait(&amp;status)) &gt; 0);

printf("TOTAL: %f clock cycles.\n", total); } ```
</pre></table></code></div></div><p>Test</p><div class="language-sh highlighter-rouge"><div class="code-header" text-data="sh"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">time</span> ./transform_image <span class="nv">$IMAGES</span>/transfo.txt
pid: 5076 image1.pgm courbe1.amp 5 image1_t.pgm
pid: 5077 image2.pgm courbe2.amp 5 image2_t.pgm
pid: 5078 image3.pgm courbe3.amp 5 image3_t.pgm
pid: 5079 image4.pgm courbe4.amp 4 image4_t.pgm
pid: 5080 image5.pgm courbe5.amp 7 image5_t.pgm
pid: 5081 image6.pgm courbe6.amp 6 image6_t.pgm
pid: 5082 image7.pgm courbe7.amp 9 image7_t.pgm
pid: 5083 image8.pgm courbe8.amp 5 image8_t.pgm
pid: 5084 image9.pgm courbe9.amp 7 image9_t.pgm
pid: 5085 image10.pgm courbe10.amp 9 image10_t.pgm
image1.pgm: 5617 x 3684 <span class="o">=</span> 20693028 pixels
image2.pgm: 5227 x 3515 <span class="o">=</span> 18372905 pixels
image3.pgm: 6660 x 9185 <span class="o">=</span> 61172100 pixels
image4.pgm: 3381 x 4914 <span class="o">=</span> 16614234 pixels
image5.pgm: 3226 x 3255 <span class="o">=</span> 10500630 pixels
image7.pgm: 3264 x 4896 <span class="o">=</span> 15980544 pixels
image6.pgm: 3677 x 3677 <span class="o">=</span> 13520329 pixels
image8.pgm: 1757 x 2636 <span class="o">=</span> 4631452 pixels
image10.pgm: 3024 x 3024 <span class="o">=</span> 9144576 pixels
image9.pgm: 2498 x 3330 <span class="o">=</span> 8318340 pixels
21427730.000000 clock cycles.
37286814.000000 clock cycles.
38725273.000000 clock cycles.
45551827.000000 clock cycles.
58591918.000000 clock cycles.
69907987.000000 clock cycles.
88265978.000000 clock cycles.
68358251.000000 clock cycles.
73210363.000000 clock cycles.
187752982.000000 clock cycles.
TOTAL: 0.000000 clock cycles.

real    0m7.214s
user    0m7.764s
sys     0m1.871s
</pre></table></code></div></div><p>The value TOTAL in the result is 0, actually we need to realize a communication between parend process and son processes.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/blogging/'>Blogging</a>, <a href='/categories/study/'>Study</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/parallel-computing/" class="post-tag no-text-decoration" >parallel_computing</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=专业课 - 基于并行计算的代码优化 - Stone SHI&url=/posts/Code-optimization/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=专业课 - 基于并行计算的代码优化 - Stone SHI&u=/posts/Code-optimization/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=专业课 - 基于并行计算的代码优化 - Stone SHI&url=/posts/Code-optimization/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink('', '')" data-toggle="tooltip" data-placement="top" title=""> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/LeetCode_daily_challenge/">LeetCode 刷题记录 - 每日一题</a><li><a href="/posts/LeetCode_backtrack/">LeetCode 刷题记录 - 回溯算法</a><li><a href="/posts/LeetCode_dynamic_programming/">LeetCode 刷题记录 - Dynamic Programming</a><li><a href="/posts/Machine-Learning/">Machine Learning - ESMI_MES-08 - Apprentissage artificiel</a><li><a href="/posts/LeetCode_graph/">LeetCode 刷题记录 - 数据结构之图（Graph）</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/leetcode/">LeetCode</a> <a class="post-tag" href="/tags/block-chain/">Block chain</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/parser/">Parser</a> <a class="post-tag" href="/tags/python/">Python</a> <a class="post-tag" href="/tags/backend/">Backend</a> <a class="post-tag" href="/tags/blog/">Blog</a> <a class="post-tag" href="/tags/compilation/">Compilation</a> <a class="post-tag" href="/tags/functional-programming/">Functional Programming</a> <a class="post-tag" href="/tags/java/">Java</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/MSI-Functional-programming/"><div class="card-body"> <span class="timeago small" >Sep 23, 2021<i class="unloaded">2021-09-23T04:58:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>专业课 - 函数式编程小项目 - 基于Haskell编写的算术表达式语法分析器</h3><div class="text-muted small"><p> 2021年9月21日，星期二，专业周第一天，讲函数式编程并且基于 Hakell 编写一个用于算术表达式的语法分析器 函数式编程 Haskell 语法分析器 Parser 项目：基于 Hakell 的算术表达式语法分析器 1. 环境搭建 环境搭建没有讲，用的是老师拷给我们的镜像，里面有安装好的 Haskell ， 有机会还是要自己研究一下。 2. 下载并测试文件 将文件全部下载...</p></div></div></a></div><div class="card"> <a href="/posts/MSI-System-Programming-TP2/"><div class="card-body"> <span class="timeago small" >Sep 23, 2021<i class="unloaded">2021-09-23T04:58:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>专业课 - 系统编程项目二 - 使用 C 语言编写一个 Linux 的 Mini shell</h3><div class="text-muted small"><p> 2021年9月22日，星期三，专业周第二天，讲操作系统和系统编程。 老师在下午布置了两个小项目，第一个是使用 Buildroot 来编译一个 Linux 内核，第二个是使用 C 语言编写一个 Linux 的 Mini shell。 这篇 blog 主要讲第二个项目，第一个项目链接在此。 Shell 项目：使用 C 语言编写一个 Linux 的 Mini shell 1. 环境搭建 ...</p></div></div></a></div><div class="card"> <a href="/posts/MSI-System-Programming-TP1/"><div class="card-body"> <span class="timeago small" >Sep 23, 2021<i class="unloaded">2021-09-23T05:11:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>专业课 - 系统编程项目一 - 使用 Buildroot 编译 Linux 内核</h3><div class="text-muted small"><p> 2021年9月22日，星期三，专业周第二天，讲操作系统和系统编程。 老师在下午布置了两个小项目，第一个是使用 Buildroot 来编译一个 Linux 内核，第二个是使用 C 语言编写一个 Linux 的 Mini shell。 这篇 blog 主要讲第一个项目，第二个项目链接在此。 操作系统 Linux 系统 Buildroot 这个东西的意义在于帮助你制作一个 Linux 镜...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Coorperation-git/" class="btn btn-outline-primary" prompt="Older"><p>GIT - 使用 Git 进行团队开发</p></a> <a href="/posts/Analyse-des-donn%C3%A9es/" class="btn btn-outline-primary" prompt="Newer"><p>Analyse des données - 1 Introduction</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/Shuxin_SHI">SHI Shuxin</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/leetcode/">LeetCode</a> <a class="post-tag" href="/tags/block-chain/">Block chain</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/parser/">Parser</a> <a class="post-tag" href="/tags/python/">Python</a> <a class="post-tag" href="/tags/backend/">Backend</a> <a class="post-tag" href="/tags/blog/">Blog</a> <a class="post-tag" href="/tags/compilation/">Compilation</a> <a class="post-tag" href="/tags/functional-programming/">Functional Programming</a> <a class="post-tag" href="/tags/java/">Java</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
